<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Validation & Rating - IPL Auction</title>
    <script src="config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Poppins', sans-serif; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #F59E0B 0%, #F97316 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }
        
        .btn-blue {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
        }
        
        /* Shine effects for medals */
        .gold-shine {
            background: linear-gradient(45deg, #FFD700, #FFEC8B, #FFD700);
            background-size: 200% 200%;
            animation: shine 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }
        
        .silver-shine {
            background: linear-gradient(45deg, #C0C0C0, #E8E8E8, #C0C0C0);
            background-size: 200% 200%;
            animation: shine 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(192, 192, 192, 0.5);
        }
        
        .bronze-shine {
            background: linear-gradient(45deg, #CD7F32, #E8B87A, #CD7F32);
            background-size: 200% 200%;
            animation: shine 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(205, 127, 50, 0.5);
        }
        
        @keyframes shine {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .rating-stars {
            display: flex;
            gap: 4px;
            margin: 8px 0;
        }
        
        .star {
            font-size: 24px;
            cursor: pointer;
            color: #4B5563;
            transition: all 0.2s;
        }
        
        .star.active {
            color: #F59E0B;
            transform: scale(1.2);
        }
        
        .star:hover {
            transform: scale(1.3);
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-blue-900 min-h-screen text-white">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div class="text-center md:text-left">
                <h1 class="text-3xl font-bold mb-2 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                    üìã Team Validation & Rating
                </h1>
                <div class="flex items-center space-x-2">
                    <div id="connectionStatus" class="flex items-center space-x-2 px-3 py-1 bg-gray-800/50 rounded-full">
                        <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                        <span class="text-sm text-gray-300">Connected</span>
                    </div>
                    <span class="text-sm text-gray-400">Room: <span id="roomCodeDisplay" class="font-bold">----</span></span>
                </div>
            </div>
            
            <div class="flex flex-wrap gap-3">
                <button onclick="refreshTeams()" 
                        class="px-4 py-2 glass-panel hover:bg-gray-800/50 rounded-xl font-semibold transition-all duration-300">
                    üîÑ Refresh Teams
                </button>
                <button onclick="goToAuctioneerPanel()" 
                        class="px-4 py-2 glass-panel hover:bg-blue-900/30 hover:text-blue-400 rounded-xl font-semibold transition-all duration-300">
                    üé§ Control Panel
                </button>
                <button id="publishResultsBtn" 
                        class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl font-semibold transition-all duration-300 hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled>
                    üèÅ Publish Results
                </button>
            </div>
        </header>

        <!-- Stats -->
        <div class="glass-panel rounded-2xl p-6 mb-8 slide-in">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="stat-card text-center p-4 rounded-lg bg-blue-900/20">
                    <div class="text-2xl font-bold text-blue-400" id="totalTeams">0</div>
                    <div class="text-sm text-gray-400">Total Teams</div>
                </div>
                <div class="stat-card text-center p-4 rounded-lg bg-green-900/20">
                    <div class="text-2xl font-bold text-green-400" id="submittedTeams">0</div>
                    <div class="text-sm text-gray-400">Submitted Playing 11</div>
                </div>
                <div class="stat-card text-center p-4 rounded-lg bg-yellow-900/20">
                    <div class="text-2xl font-bold text-yellow-400" id="ratedTeams">0</div>
                    <div class="text-sm text-gray-400">Rated Teams</div>
                </div>
                <div class="stat-card text-center p-4 rounded-lg bg-purple-900/20">
                    <div class="text-2xl font-bold text-purple-400" id="pendingTeams">0</div>
                    <div class="text-sm text-gray-400">Pending Rating</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Team List -->
            <div class="lg:col-span-2">
                <div class="glass-panel rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold text-yellow-400 flex items-center gap-2">
                            <span class="text-2xl">üë•</span>
                            Teams for Rating
                        </h2>
                        <span class="bg-blue-500/20 text-blue-300 px-3 py-1 rounded-full text-sm">
                            <span id="teamsCount">0</span> teams
                        </span>
                    </div>
                    
                    <div id="teamsList" class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                        <div class="text-center py-8">
                            <div class="text-4xl mb-3">‚è≥</div>
                            <p class="text-gray-400">Loading teams...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Rating Panel -->
            <div class="space-y-6">
                <!-- Current Team Details -->
                <div id="ratingPanel" class="glass-panel rounded-2xl p-6 hidden">
                    <h2 class="text-2xl font-bold mb-4 text-yellow-400" id="currentTeamName">Team Name</h2>
                    
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-400">Current Rating:</span>
                            <span id="currentRating" class="text-2xl font-bold text-yellow-400">-</span>
                        </div>
                        
                        <div class="rating-stars mb-4" id="ratingStars">
                            <!-- Stars will be generated by JavaScript -->
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Comments:</label>
                            <textarea id="ratingComments" 
                                      class="w-full glass-panel border border-gray-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-yellow-500 transition-all duration-300"
                                      rows="3" 
                                      placeholder="Add comments about this team's playing 11 selection..."></textarea>
                        </div>
                        
                        <button onclick="submitRating()" 
                                class="w-full py-3 btn-success rounded-xl font-bold text-lg transition-all duration-300 hover:scale-[1.02]">
                            ‚úÖ Submit Rating
                        </button>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <div class="bg-gray-800/30 p-3 rounded-lg">
                            <div class="text-sm text-gray-400">Squad Size</div>
                            <div class="text-lg font-bold" id="teamSquadSize">-</div>
                        </div>
                        <div class="bg-gray-800/30 p-3 rounded-lg">
                            <div class="text-sm text-gray-400">Remaining Budget</div>
                            <div class="text-lg font-bold text-green-400" id="teamBudget">-</div>
                        </div>
                        <div class="bg-gray-800/30 p-3 rounded-lg">
                            <div class="text-sm text-gray-400">Overseas Players</div>
                            <div class="text-lg font-bold text-blue-400" id="teamOverseas">-</div>
                        </div>
                        <div class="bg-gray-800/30 p-3 rounded-lg">
                            <div class="text-sm text-gray-400">Indian Players</div>
                            <div class="text-lg font-bold" id="teamIndian">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- Preview Ranking -->
                <div class="glass-panel rounded-2xl p-6">
                    <h2 class="text-2xl font-bold mb-4 text-yellow-400 flex items-center gap-2">
                        <span class="text-2xl">üèÜ</span>
                        Preview Ranking
                    </h2>
                    
                    <div id="rankingPreview" class="space-y-3 max-h-[300px] overflow-y-auto">
                        <div class="text-center py-4">
                            <p class="text-gray-400">Rate teams to see ranking</p>
                        </div>
                    </div>
                </div>
                
                <!-- All Rated Notice -->
                <div id="allRatedNotice" class="glass-panel rounded-2xl p-6 bg-green-900/20 border border-green-500/30 hidden">
                    <div class="text-center">
                        <div class="text-4xl mb-3">üéâ</div>
                        <h3 class="text-xl font-bold text-green-400 mb-2">All Teams Rated!</h3>
                        <p class="text-gray-300 mb-4">You have rated all teams. Ready to publish results.</p>
                        <button onclick="publishResults()" 
                                class="w-full py-3 bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-[1.02]">
                            üèÅ Publish Final Results
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Details Modal -->
    <div id="teamModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/80"></div>
        <div class="glass-panel rounded-2xl p-6 max-w-4xl w-11/12 max-h-[90vh] overflow-y-auto z-10">
            <div id="teamModalContent">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/70"></div>
        <div class="glass-panel rounded-2xl p-6 max-w-md mx-4 z-10">
            <div class="text-center">
                <div class="text-4xl mb-4" id="modalIcon">‚ö†Ô∏è</div>
                <h3 class="text-2xl font-bold mb-2" id="modalTitle">Alert</h3>
                <p class="text-gray-300 mb-6" id="modalMessage">This is a modal message</p>
                <button onclick="closeModal()" 
                        class="px-6 py-2 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg font-semibold">
                    OK
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        const socket = io(window.BACKEND_URL,{ transports: ["websocket", "polling"],}
        );
        let currentRoomCode = null;
        let currentSessionId = null;
        let currentUsername = null;
        let teams = [];
        let currentTeamIndex = null;
        let currentRating = 0;
        
        // DOM Elements
        const roomCodeDisplay = document.getElementById('roomCodeDisplay');
        const totalTeams = document.getElementById('totalTeams');
        const submittedTeams = document.getElementById('submittedTeams');
        const ratedTeams = document.getElementById('ratedTeams');
        const pendingTeams = document.getElementById('pendingTeams');
        const teamsCount = document.getElementById('teamsCount');
        const teamsList = document.getElementById('teamsList');
        const ratingPanel = document.getElementById('ratingPanel');
        const publishResultsBtn = document.getElementById('publishResultsBtn');
        const allRatedNotice = document.getElementById('allRatedNotice');
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìã Validation page loaded');
            
            // Get session data
            const auctioneerSession = localStorage.getItem('auctioneerSession');
            const currentSession = localStorage.getItem('currentSession');
            
            if (auctioneerSession) {
                try {
                    const sessionData = JSON.parse(auctioneerSession);
                    currentSessionId = sessionData.sessionId;
                    currentUsername = sessionData.username;
                    currentRoomCode = sessionData.roomCode;
                    
                    console.log(`üîó Loaded auctioneer session for room: ${currentRoomCode}`);
                    
                    if (currentRoomCode) {
                        roomCodeDisplay.textContent = currentRoomCode;
                        initializeSocket();
                    } else {
                        showAlert('No Room', 'No room found. Please return to control panel.', '‚ùå');
                        setTimeout(() => {
                            window.location.href = 'auctioneer.html';
                        }, 3000);
                    }
                    
                } catch (error) {
                    console.error('‚ùå Error parsing session:', error);
                    redirectToLogin();
                }
            } else {
                redirectToLogin();
            }
        });
        
        function initializeSocket() {
            socket.on('connect', () => {
                updateConnectionStatus('Connected', 'green');
                console.log('‚úÖ Connected to validation');
                
                // Join the validation room
                socket.emit('joinValidation', {
                    roomCode: currentRoomCode,
                    sessionId: currentSessionId,
                    username: currentUsername,
                    isAuctioneer: true
                });
            });
            
            socket.on('validationJoined', (data) => {
                console.log('‚úÖ Joined validation room:', data);
                // Load teams after successfully joining
                loadTeams();
            });
            
            socket.on('connect_error', (error) => {
                updateConnectionStatus('Connection Error', 'red');
                console.error('‚ùå Connection error:', error);
            });
            
            // Listen for playing 11 submissions from users
            socket.on('submitPlaying11', (data) => {
                console.log('üì• Playing 11 submitted by user:', {
                    username: data.username,
                    team: data.team?.name || data.team,
                    playing11: data.playing11?.length || 0,
                    impactPlayers: data.impactPlayers?.length || 0,
                    captain: data.captain?.name || 'No captain'
                });
                
                showAlert('New Submission', `${data.username} (${data.team?.name || data.team}) submitted playing 11!`, '‚úÖ');
                loadTeams(); // Refresh teams list
            });
            
            socket.on('allPlaying11Submitted', (data) => {
                console.log('üéâ All playing 11 submitted:', data);
                showAlert('All Submitted', 'All users have submitted their playing 11! Start rating teams.', 'üéâ');
                loadTeams();
            });
            
            socket.on('teamsForValidation', (data) => {
                console.log('üë• Teams loaded for validation:', data);
                if (data && data.teams) {
                    teams = data.teams;
                } else if (Array.isArray(data)) {
                    teams = data;
                } else {
                    teams = [];
                }
                renderTeams();
                updateStats();
                updateRankingPreview();
                checkAllRated();
            });
            
            socket.on('ratingSuccess', (data) => {
                console.log('‚≠ê Rating success:', data);
                showAlert('Rating Submitted', `Rating ${data.rating}/10 saved for ${data.username}`, '‚≠ê');
                loadTeams(); // Refresh to show updated rating
            });
            
            socket.on('finalResultsPublished', (data) => {
                console.log('üèÜ Results published:', data);
                showAlert('Results Published', 'Final results have been published to all users!', 'üèÜ');
                
                // Store results data
                localStorage.setItem('finalResults', JSON.stringify(data));
                
                // Redirect auctioneer after delay
                setTimeout(() => {
                    window.location.href = 'results.html';
                }, 3000);
            });
            
            socket.on('error', (data) => {
                console.error('‚ùå Socket error:', data);
                showAlert('Error', data.message, '‚ùå');
            });
            
            socket.on('roomNotFound', (data) => {
                console.error('‚ùå Room not found:', data);
                showAlert('Room Error', 'Validation room not found. Please return to control panel.', '‚ùå');
                setTimeout(() => {
                    window.location.href = 'auctioneer.html';
                }, 3000);
            });
        }
        
        function loadTeams() {
            if (!currentRoomCode || !currentSessionId) {
                console.error('‚ùå Cannot load teams: Missing room code or session ID');
                return;
            }
            
            console.log('üîÑ Loading teams for validation...');
            socket.emit('getTeamsForValidation', {
                roomCode: currentRoomCode,
                sessionId: currentSessionId
            });
        }
        
        function renderTeams() {
            teamsList.innerHTML = '';
            
            if (!teams || teams.length === 0) {
                teamsList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-3">üòî</div>
                        <p class="text-gray-400">No teams found</p>
                        <button onclick="loadTeams()" 
                                class="mt-3 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg font-semibold">
                            üîÑ Load Teams
                        </button>
                    </div>
                `;
                return;
            }
            
            teams.forEach((team, index) => {
                const teamCard = document.createElement('div');
                teamCard.className = 'glass-panel rounded-xl p-4 cursor-pointer hover:bg-gray-800/30 transition-all duration-300 slide-in';
                teamCard.onclick = () => openTeamDetails(index);
                
                // Extract team info with fallbacks
                const teamName = team.team?.name || team.teamName || team.name || 'Unknown Team';
                const teamColor = team.team?.color || '#666666';
                const teamLogo = team.team?.logo || null;
                const username = team.username || team.user || 'Unknown User';
                const submitted = team.submitPlaying11 || team.submitted || team.playing11?.length > 0 || false;
                const rating = team.rating;
                const ratingComments = team.ratingComments || '';
                
                // Status badges
                const submittedBadge = submitted ? 
                    '<span class="px-2 py-1 bg-green-500/20 text-green-400 rounded-full text-xs">Submitted</span>' :
                    '<span class="px-2 py-1 bg-red-500/20 text-red-400 rounded-full text-xs">Pending</span>';
                
                const ratingBadge = rating ? 
                    `<span class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded-full text-xs">${rating}/10</span>` :
                    '<span class="px-2 py-1 bg-gray-500/20 text-gray-400 rounded-full text-xs">Not Rated</span>';
                
                teamCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center" 
                                 style="background: ${teamColor}20; border: 2px solid ${teamColor}">
                                ${teamLogo ? 
                                    `<img src="${teamLogo}" alt="${teamName}" class="w-8 h-8 rounded-full">` :
                                    `<span class="text-xl font-bold" style="color: ${teamColor}">${teamName.charAt(0)}</span>`
                                }
                            </div>
                            <div>
                                <div class="font-bold">${teamName}</div>
                                <div class="text-sm text-gray-400">${username}</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            ${submittedBadge}
                            ${ratingBadge}
                        </div>
                    </div>
                    ${rating ? `
                        <div class="mt-3 pt-3 border-t border-gray-700">
                            <div class="text-sm text-gray-400">Comments:</div>
                            <div class="text-sm truncate">${ratingComments || 'No comments'}</div>
                        </div>
                    ` : ''}
                `;
                
                teamsList.appendChild(teamCard);
            });
            
            teamsCount.textContent = teams.length;
        }
        
        function openTeamDetails(index) {
            currentTeamIndex = index;
            const team = teams[index];
            
            // Extract team info with fallbacks
            const teamName = team.team?.name || team.teamName || team.name || 'Unknown Team';
            const currentRatingValue = team.rating || 0;
            const ratingComments = team.ratingComments || '';
            
            // Update rating panel
            ratingPanel.classList.remove('hidden');
            document.getElementById('currentTeamName').textContent = teamName;
            document.getElementById('currentRating').textContent = currentRatingValue ? `${currentRatingValue}/10` : '-';
            document.getElementById('ratingComments').value = ratingComments;
            
            // Update team stats
            const squadSize = team.squadLimits?.total || team.totalPlayers || team.retainedPlayers?.length + team.auctionPlayers?.length || 0;
            const budget = team.budget || team.remainingBudget || 0;
            const overseas = team.squadLimits?.overseas || team.overseasCount || 0;
            const indian = team.squadLimits?.indian || squadSize - overseas || 0;
            
            document.getElementById('teamSquadSize').textContent = squadSize;
            document.getElementById('teamBudget').textContent = `‚Çπ${budget.toFixed(2)} Cr`;
            document.getElementById('teamOverseas').textContent = overseas;
            document.getElementById('teamIndian').textContent = indian;
            
            // Generate stars
            generateStars(currentRatingValue);
            
            // Also open modal with detailed view
            openTeamModal(index);
        }
        
        function generateStars(currentScore) {
            const starsContainer = document.getElementById('ratingStars');
            starsContainer.innerHTML = '';
            currentRating = currentScore;
            
            for (let i = 1; i <= 10; i++) {
                const star = document.createElement('span');
                star.className = `star ${i <= currentScore ? 'active' : ''}`;
                star.textContent = '‚òÖ';
                star.dataset.value = i;
                
                star.addEventListener('click', () => {
                    currentRating = i;
                    generateStars(currentRating);
                    document.getElementById('currentRating').textContent = `${currentRating}/10`;
                });
                
                starsContainer.appendChild(star);
            }
        }
        
        function submitRating() {
            if (currentTeamIndex === null || currentRating === 0) {
                showAlert('Error', 'Please select a rating', '‚ùå');
                return;
            }
            
            const team = teams[currentTeamIndex];
            const comments = document.getElementById('ratingComments').value.trim();
            const username = team.username || team.user;
            
            if (!username) {
                showAlert('Error', 'Cannot rate team: No username found', '‚ùå');
                return;
            }
            
            socket.emit('rateTeam', {
                roomCode: currentRoomCode,
                username: username,
                rating: currentRating,
                comments: comments,
                sessionId: currentSessionId
            });
        }
        
        function openTeamModal(index) {
            const team = teams[index];
            const modal = document.getElementById('teamModal');
            const modalContent = document.getElementById('teamModalContent');
            
            // Extract team info with fallbacks
            const teamName = team.team?.name || team.teamName || team.name || 'Unknown Team';
            const username = team.username || team.user || 'Unknown User';
            const teamColor = team.team?.color || '#666666';
            const teamLogo = team.team?.logo || null;
            
            // Get playing 11 data with fallbacks
            const playing11 = team.playing11 || [];
            const impactPlayers = team.impactPlayers || [];
            const captain = team.captain || {};
            
            // Build playing 11 table
            let playing11Table = '';
            if (playing11.length > 0) {
                playing11Table = `
                    <div class="mb-6">
                        <h4 class="text-xl font-bold text-green-400 mb-3 flex items-center gap-2">
                            <span>üèè</span>
                            Playing 11 
                            ${captain.name ? `<span class="text-sm text-yellow-400">(Captain: ${captain.name})</span>` : ''}
                        </h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="bg-gray-800/50">
                                        <th class="p-3 text-left">#</th>
                                        <th class="p-3 text-left">Player</th>
                                        <th class="p-3 text-left">Role</th>
                                        <th class="p-3 text-left">Overseas</th>
                                        <th class="p-3 text-left">Captain</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${playing11.map((player, idx) => {
                                        const isCaptain = player.isCaptain || captain.id === player.id || captain.name === player.name;
                                        return `
                                            <tr class="border-b border-gray-700/50 hover:bg-gray-800/30">
                                                <td class="p-3 font-bold ${isCaptain ? 'text-yellow-400' : ''}">
                                                    ${player.slotPosition || idx + 1}
                                                </td>
                                                <td class="p-3 ${isCaptain ? 'font-bold text-yellow-400' : ''}">${player.name}</td>
                                                <td class="p-3">${player.role || 'Player'}</td>
                                                <td class="p-3">${player.isOverseas ? 'Yes ‚úàÔ∏è' : 'No üáÆüá≥'}</td>
                                                <td class="p-3">${isCaptain ? '‚≠ê Captain' : ''}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                playing11Table = '<p class="text-gray-400 mb-6">No playing 11 submitted yet.</p>';
            }
            
            // Build impact players table
            let impactTable = '';
            if (impactPlayers.length > 0) {
                impactTable = `
                    <div class="mb-6">
                        <h4 class="text-xl font-bold text-blue-400 mb-3">‚ö° Impact Players</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="bg-gray-800/50">
                                        <th class="p-3 text-left">#</th>
                                        <th class="p-3 text-left">Player</th>
                                        <th class="p-3 text-left">Role</th>
                                        <th class="p-3 text-left">Overseas</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${impactPlayers.map((player, idx) => `
                                        <tr class="border-b border-gray-700/50 hover:bg-gray-800/30">
                                            <td class="p-3 font-bold">${idx + 1}</td>
                                            <td class="p-3">${player.name}</td>
                                            <td class="p-3">${player.role || 'Player'}</td>
                                            <td class="p-3">${player.isOverseas ? 'Yes ‚úàÔ∏è' : 'No üáÆüá≥'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                impactTable = '<p class="text-gray-400 mb-6">No impact players selected.</p>';
            }
            
            // Build squad summary
            const squadSize = team.squadLimits?.total || team.totalPlayers || team.retainedPlayers?.length + team.auctionPlayers?.length || 0;
            const budget = team.budget || team.remainingBudget || 0;
            const overseas = team.squadLimits?.overseas || team.overseasCount || 0;
            const indian = team.squadLimits?.indian || squadSize - overseas || 0;
            
            const squadSummary = `
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                    <div class="bg-gray-800/30 p-3 rounded-lg">
                        <div class="text-sm text-gray-400">Total Players</div>
                        <div class="text-xl font-bold">${squadSize}</div>
                    </div>
                    <div class="bg-gray-800/30 p-3 rounded-lg">
                        <div class="text-sm text-gray-400">Remaining Budget</div>
                        <div class="text-xl font-bold text-green-400">‚Çπ${budget.toFixed(2)} Cr</div>
                    </div>
                    <div class="bg-gray-800/30 p-3 rounded-lg">
                        <div class="text-sm text-gray-400">Overseas Players</div>
                        <div class="text-xl font-bold text-blue-400">${overseas}</div>
                    </div>
                    <div class="bg-gray-800/30 p-3 rounded-lg">
                        <div class="text-sm text-gray-400">Indian Players</div>
                        <div class="text-xl font-bold">${indian}</div>
                    </div>
                </div>
            `;
            
            modalContent.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 rounded-full flex items-center justify-center" 
                             style="background: ${teamColor}20; border: 2px solid ${teamColor}">
                            ${teamLogo ? 
                                `<img src="${teamLogo}" alt="${teamName}" class="w-12 h-12 rounded-full">` :
                                `<span class="text-2xl font-bold" style="color: ${teamColor}">${teamName.charAt(0)}</span>`
                            }
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-yellow-400">${teamName}</h3>
                            <div class="text-gray-400">${username}</div>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="text-2xl hover:text-yellow-400">‚úï</button>
                </div>
                
                ${squadSummary}
                ${playing11Table}
                ${impactTable}
                
                ${team.rating ? `
                    <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-xl p-4 mb-4">
                        <h4 class="text-lg font-bold text-yellow-400 mb-2">Current Rating: ${team.rating}/10</h4>
                        <p class="text-gray-300">${team.ratingComments || 'No comments provided'}</p>
                        <div class="text-sm text-gray-400 mt-2">Rated by: ${team.ratedBy || 'Auctioneer'}</div>
                    </div>
                ` : ''}
                
                <div class="flex space-x-3">
                    <button onclick="closeModal()" 
                            class="flex-1 py-3 glass-panel hover:bg-gray-800/50 rounded-xl font-semibold transition-all duration-300">
                        Close
                    </button>
                    ${!team.rating ? `
                        <button onclick="rateThisTeam(${index})" 
                                class="flex-1 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-xl font-bold transition-all duration-300">
                            ‚≠ê Rate This Team
                        </button>
                    ` : ''}
                </div>
            `;
            
            modal.classList.remove('hidden');
        }
        
        function rateThisTeam(index) {
            closeModal();
            openTeamDetails(index);
        }
        
        function closeModal() {
            document.getElementById('teamModal').classList.add('hidden');
            document.getElementById('alertModal').classList.add('hidden');
        }
        
        function updateRankingPreview() {
            const rankingPreview = document.getElementById('rankingPreview');
            const ratedTeamsList = teams.filter(t => t.rating !== null && t.rating !== undefined);
            
            if (ratedTeamsList.length === 0) {
                rankingPreview.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-gray-400">Rate teams to see ranking</p>
                    </div>
                `;
                return;
            }
            
            // Sort by rating
            const sortedTeams = [...ratedTeamsList].sort((a, b) => b.rating - a.rating);
            
            rankingPreview.innerHTML = sortedTeams.map((team, index) => {
                const teamName = team.team?.name || team.teamName || team.name || 'Unknown Team';
                const username = team.username || team.user || '';
                
                let medalClass = '';
                if (index === 0) medalClass = 'gold-shine';
                else if (index === 1) medalClass = 'silver-shine';
                else if (index === 2) medalClass = 'bronze-shine';
                
                return `
                    <div class="flex items-center justify-between p-3 rounded-lg bg-gray-800/30 ${medalClass}">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold ${index < 3 ? 'text-white' : 'text-gray-400'}">
                                ${index + 1}
                            </div>
                            <div>
                                <div class="font-semibold">${teamName}</div>
                                <div class="text-xs text-gray-400">${username}</div>
                            </div>
                        </div>
                        <div class="text-xl font-bold text-yellow-400">${team.rating}/10</div>
                    </div>
                `;
            }).join('');
        }
        
        function checkAllRated() {
            const allRated = teams.length > 0 && teams.every(t => t.rating !== null && t.rating !== undefined);
            
            if (allRated) {
                allRatedNotice.classList.remove('hidden');
                publishResultsBtn.disabled = false;
            } else {
                allRatedNotice.classList.add('hidden');
                publishResultsBtn.disabled = true;
            }
        }
        
        function publishResults() {
            if (!confirm('Publish final results to all users? This will show the podium ranking.')) return;
            
            socket.emit('publishResults', {
                roomCode: currentRoomCode,
                sessionId: currentSessionId
            });
            
            publishResultsBtn.disabled = true;
            publishResultsBtn.innerHTML = 'PUBLISHING...';
        }
        
        function refreshTeams() {
            loadTeams();
        }
        
        function goToAuctioneerPanel() {
            window.location.href = 'auctioneer.html';
        }
        
        function showAlert(title, message, icon = '‚ö†Ô∏è') {
            const modal = document.getElementById('alertModal');
            document.getElementById('modalIcon').textContent = icon;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            modal.classList.remove('hidden');
        }
        
        function updateConnectionStatus(status, color) {
            const connectionStatus = document.getElementById('connectionStatus');
            const colorClass = color === 'green' ? 'bg-green-500' : 'bg-red-500';
            const textColor = color === 'green' ? 'text-green-400' : 'text-red-400';
            
            connectionStatus.innerHTML = `
                <div class="w-2 h-2 rounded-full ${colorClass} mr-2 ${color === 'green' ? 'animate-pulse' : ''}"></div>
                <span class="${textColor} text-sm">${status}</span>
            `;
        }
        
        function redirectToLogin() {
            localStorage.removeItem('auctioneerSession');
            localStorage.removeItem('currentSession');
            window.location.href = 'login.html';
        }
        
        window.closeModal = closeModal;
        
        console.log('‚úÖ Validation page ready');
    </script>
</body>
</html>